trigger:
- main
- master

pool:
  name: self-hosted   # Windows agent

steps:
# Step 1: Checkout code
- checkout: self
  displayName: 'Checkout Code'

# Step 2: Install PHP dependencies (PowerShell for Windows)
- task: PowerShell@2
  displayName: 'Install PHP Dependencies'
  inputs:
    targetType: 'inline'
    script: |
      if (Test-Path "composer.json") {
          Write-Host "Installing PHP dependencies..."
          composer install --no-dev --optimize-autoloader
      } else {
          Write-Host "No composer.json found, skipping dependency installation."
      }

# Step 3: Deploy PHP App directly to Azure App Service
- task: AzureWebApp@1
  displayName: 'Deploy PHP App to Azure App Service'
  inputs:
    azureSubscription: 'azure-rm-connection'
    appName: 'php-mysql-app'
    package: '$(Build.SourcesDirectory)'
